"use strict";APRI.UI={textResize:function(e){var t=$("html"),n,r,i=2;if(e===0)t.css("font-size","16px");else{n=parseFloat(t.css("font-size"));r=n+e*i+"px";t.css("font-size",r)}Modernizr.localstorage&&(localStorage.font_size_pref=r)},initTOC:function(){if(APRI.toc){var e='<ul class="toc-dropdown box">\n',t,n,r,i,s,o;APRI.toc.header!==undefined&&(e+='<li class="hdr"><div class="cover"><a href="'+APRI.toc.header.cover_url+'" class="cover-link"><img src="'+APRI.toc.header.image+'" /></a></div>'+'<div class="title">'+APRI.toc.header.title+"</div>"+'<div class="dek">'+APRI.toc.header.dek+"</div>"+"</li>");if(APRI.toc.chapters!==undefined){t=APRI.toc.chapters;for(n=0,r=t.length;n<r;n++)for(i in t[n])if(t[n].hasOwnProperty(i)){s="";t[n][i]===""?o='<li class="chap"><span class="unavailable">'+i+"</span></li>\n":o='<li class="chap"><a href="'+t[n][i]+'" class="'+s+'">'+i+"</a></li>\n";e+=o}}e+='<li class="dashboard-link"><a href="../index.html">My Apress Library</a></li>';e+="</ul>\n";jQuery("article").before(jQuery(e))}},initPanelNavigation:function(){var e=$.jPanelMenu({keyboardShortcuts:!1,duration:125});e.on();jQuery(document).on("click",e.menu+" li a",function(t){e.isOpen()&&jQuery(t.target).attr("href").substring(0,1)==="#"&&e.close()});jQuery(".jPanelMenu-panel > .nav-container").remove();jQuery(".jPanelMenu-panel > #main-navigation").remove();jQuery("#jPanelMenu-menu").length||jQuery(".menu-trigger a").hide()},initTextResizeHandler:function(){var e=this;jQuery(".btn.fs-smaller").bind("click",function(t){t.stopPropagation();t.preventDefault();e.textResize(-1)});jQuery(".btn.fs-default").bind("click",function(t){t.stopPropagation();t.preventDefault();e.textResize(0)});jQuery(".btn.fs-larger").bind("click",function(t){t.stopPropagation();t.preventDefault();e.textResize(1)});Modernizr.localstorage&&localStorage.font_size_pref!==undefined&&$("html").css("font-size",localStorage.font_size_pref)}};APRI.CME={localStorageSupport:!1,templates:{editorContainerTemplate:'<div class="editor-trigger">\n<a href="#inline-code-example" class="show-inline-editor button">Open editor</a>\n<a href="#close-inline-code-example" class="close-inline-editor button">Close editor</a>\n</div>\n\n<div class="inline-codeview-container" style="width: 100%; float: left; padding-top: 1.5em; "></div>',editorTemplate:'<div id="code-view-source">\n\n<div class="code-editor-container">\n<iframe id="preview"></iframe>\n</div>\n\n<div class="code-mirror-container">\n<div class="code-mirror-scroll-wrap">\n<textarea id="code" name="code">\n</textarea>\n</div>\n</div>\n<div class="control-bar">\n<div class="control save">Save</div>\n<div class="control reset">Reset</div>\n</div>\n</div>'},updatePreview:function(e){var t=e[0],n=t.editor.getValue();if(t.cache!==n){t.cache=n;var r=jQuery("#preview",t.container).get(0),i=r.contentDocument||r.contentWindow.document;i.open();i.write(t.cache);i.close()}},inlineEditor:function(e){var t=this;this.trigger=e;this.delay=0;this.listingNumber=e.data("listing");this.cacheID=APRI.ISBNOnline+"_"+this.listingNumber;APRI.CME[this.listingNumber]=this;this.container=this.trigger.parents(".listing:first").find(".inline-codeview-container");this.container.html(jQuery(APRI.CME.templates.editorTemplate));this.resetControl=jQuery(".control-bar .control.reset",this.container);this.saveControl=jQuery(".control-bar .control.save",this.container);this.cache="";this.previewFrame=jQuery("#preview",this.container).get(0);this.previewHeight=this.container.parents(".listing:first").data("preview-height")+"px";this.editor=CodeMirror.fromTextArea(jQuery("#code",this.container).get(0),{mode:"text/html",tabMode:"indent",theme:"ambiance",lineWrapping:!0,lineNumbers:!0,onChange:function(){window.clearTimeout(t.delay);t.delay=window.setTimeout(function(){APRI.CME.updatePreview([t])},300)}});this.resetControl.bind("click",function(e){e.stopPropagation();e.preventDefault();t.reset()});this.saveControl.bind("click",function(e){e.stopPropagation();e.preventDefault();t.save()});this.removeEditor=function(){window.clearTimeout(t.delay);t.editor=null;t.container.html("")};this.retrieve();jQuery("#preview",this.container).height(this.previewHeight)},initCodeEditors:function(){jQuery("figure.listing[data-listing]").each(function(){var e=jQuery(this),t=e.data("listing");jQuery("figcaption:first",e).after(jQuery(APRI.CME.templates.editorContainerTemplate));jQuery(".button",e).data("listing",t)});jQuery(".show-inline-editor:not('.open')").bind("click",function(e){e.stopPropagation();e.preventDefault();var t=jQuery(this),n=t.parents("figure:first"),r=jQuery(this).data("listing");t.addClass("open");n.addClass("open-editor");APRI.CME[r]=new APRI.CME.inlineEditor(t);jQuery(".static-code-container:first",n).hide()});jQuery(".close-inline-editor").bind("click",function(e){e.stopPropagation();e.preventDefault();var t=jQuery(this),n=t.parents("figure:first"),r=jQuery(this).data("listing");APRI.CME[r].removeEditor();APRI.CME[r]=null;jQuery(".static-code-container:first",n).show();t.siblings(".show-inline-editor:first").removeClass("open");n.removeClass("open-editor")})}};APRI.CME.inlineEditor.prototype.retrieve=function(){APRI.CME.localStorageSupport&&localStorage[this.cacheID]?this.editor.setValue(localStorage[this.cacheID]):this.reset()};APRI.CME.inlineEditor.prototype.clearSaved=function(){APRI.CME.localStorageSupport&&localStorage[this.cacheID]&&localStorage.removeItem(this.cacheID)};APRI.CME.inlineEditor.prototype.save=function(){APRI.CME.localStorageSupport&&localStorage.setItem(this.cacheID,this.editor.getValue())};APRI.CME.inlineEditor.prototype.reset=function(){this.editor.setValue(APRI.CME.codeListings[this.listingNumber].code);this.clearSaved()};APRI.UTILS={checkStorageSupport:function(){Modernizr.localstorage&&(APRI.CME.localStorageSupport=!0)},formatStaticCode:function(){var e=[],t=jQuery("figure.listing"),n,r,i,s,o,u,a,f,l='<div class="static-code-container"></div>';t.each(function(){r=jQuery(this);i=jQuery("pre:first",r);s=jQuery("code:first",i);n=s.text();f=s.data("cm-mode")?s.data("cm-mode"):"javascript";o=s.data("bold")?s.data("bold").split(","):[];u=jQuery(l).insertAfter(i).get(0);i.remove();a=new CodeMirror(u,{mode:f,tabMode:"indent",theme:"static",readOnly:!0,lineWrapping:!0,lineNumbers:!1,pollInterval:3e3,value:n});e.push(a);if(o.length)for(var t=0,c=o.length;t<c;t++)a.setLineClass(parseInt(o[t],10),"cm-strong")})}};jQuery(function(){APRI.UI.initPanelNavigation();APRI.UI.initTextResizeHandler();APRI.UI.initTOC();$(".popbox").popbox();APRI.UTILS.checkStorageSupport();APRI.CME.initCodeEditors();APRI.UTILS.formatStaticCode()});