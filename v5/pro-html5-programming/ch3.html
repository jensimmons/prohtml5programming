<!doctype html>

<!--[if lt IE 7]>      <html class="ie6 ie6-7 ie6-8"> <![endif]-->
<!--[if IE 7]>         <html class="ie7 ie6-7 ie7-8 ie6-8"> <![endif]-->
<!--[if IE 8]>         <html class="ie8 ie7-8 ie6-8"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

    <title>Pro HTML5 Programming: Chapter 3 | Working with Scalable Vector Graphics</title>

    <meta name="description" content="">
    <meta name="author" content="">

    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="cleartype" content="on">
    
    <meta name="apple-mobile-web-app-title" content="Pro HTML5">

    <!-- Tile icon for Win8 (144x144 + tile color) -->
    <meta name="msapplication-TileImage" content="apple-touch-icon-144x144.png">
    <meta name="msapplication-TileColor" content="#da2f1e">

    <link rel="shortcut icon" href="/favicon.ico">    

    <!-- CSS -->
    <link rel="stylesheet" href="../assets/libraries/codemirror/lib/codemirror.css">
    <link rel="stylesheet" href="../assets/libraries/codemirror/theme/ambiance.css">
    <link rel="stylesheet" href="../assets/libraries/codemirror/theme/static.css">
  	<link rel="stylesheet" href="../assets/stylesheets/style.css" />

    <!-- JavaScript -->
    <!--[if (lt IE 9) & (!IEMobile)]>
    <script src="js/selectivizr-min.js"></script>
    <![endif]-->
    
    <script type="text/javascript" charset="utf-8">
        "use strict";
        var APRI = {
          ISBNOnline: '978-1-4302-3865-2'
        };
        
    </script>
    
    <!-- MOD: LOAD JQUERY + COLORBOX SUPPORT FOR CODE VIEW -->
    <script src="../assets/js/jquery-1.8.0.min.js"></script>
    <script src="../assets/js/modernizr-latest.js"></script>

    <script src="../assets/js/jpanelmenu-1.0.0.js"></script>
    <script src="../assets/js/bootstrap-dropdown.js"></script>
    <script src="../assets/libraries/codemirror/lib/codemirror.js"></script>
    <script src="../assets/libraries/codemirror/mode/xml/xml.js"></script>
    <script src="../assets/libraries/codemirror/mode/javascript/javascript.js"></script>
    <script src="../assets/libraries/codemirror/mode/css/css.js"></script>
    <script src="../assets/libraries/codemirror/mode/htmlmixed/htmlmixed.js"></script>
    <script src="../assets/js/navigation.js"></script>
    <script src="../assets/js/code_editor.js"></script>
    <script src="code_listings/code_listings_ch3.js"></script>
    <script src="toc.js"></script>  

  </head>

  <body>

    <header class="controls-bar">
      <h1 class="book-title">Pro HTML5 Programming</h1>
      
      <div class="menu-link orig-menu menu-trigger">
        <a class="svg-menu" href="#main-navigation">Chapter Contents</a>
      </div>
      
      <div class="font-size-controls">
        <a href="#" class="btn btn-fs fs-smaller">Smaller</a>
        <a href="#" class="btn btn-fs fs-larger">Larger</a>
      </div>
    
      <div class="btn-group toc-link" id="toc">
        <a class="btn dropdown-toggle" data-toggle="dropdown" href="#">
          Table of Contents
          <span class="caret"></span>
        </a>
      </div>
    
    </header>
  
<!--======================== CONTENT ========================-->

<article role="main">
<div id="wrapper">

<hgroup>
<a id="chapter_title" class="section-anchor"></a>
  <h1>Chapter 3</h1>
  <h1>Working with Scalable Vector Graphics</h1>
</hgroup>

<p>In this chapter, we&#x2019;ll explore what you can do with another graphics feature in HTML5: <em>Scalable Vector Graphics</em>. Scalable Vector Graphics, or SVG, is an expressive language for two dimensional graphics.</p>

<section id="sec2_3">
<a id="hdr_sec2_3" class="section-anchor"></a>


<h2>Overview of SVG</h2>

<p>In this section we&#x2019;ll look at the standard vector graphics support in HTML5 browsers, but first, let&#x2019;s review a couple of graphics concepts: raster and vector graphics.</p>

<p>In raster graphics, an image is represented by a two dimensional grid of pixels. The HTML5 Canvas 2d API is an example of a raster graphics API. Drawing with the Canvas API updates the canvas&#x2019;s pixels. PNG and JPEG are examples of raster image formats. The data in PNG and JPEG images also represents pixels.</p>

<p>Vector graphics are quite different. Vector graphics represent images with mathematical descriptions of geometry. A vector image contains all of the information needed to draw an image from high-level geometric objects such as lines and shapes. As you can tell by the name, SVG is an example of vector graphics. Like HTML, SVG is a file format that also has an API. SVG combined with the DOM APIs form a vector graphics API. It is possible to embed raster graphics such as PNG images inside of SVG, but SVG is primarily a vector format.</p>

<section id="sec3_3">
<a id="hdr_sec3_3" class="section-anchor"></a>


<h3>History</h3>

<p>SVG has been around for a few years. SVG 1.0 was published as a W3C recommendation in 2001. SVG was originally available in browsers with the use of a plugin. Shortly afterward, browsers added native support for SVG images.</p>

<p>Inline SVG in HTML has a shorter history. A defining characteristic of SVG is that it is based on XML. HTML, of course, has a different syntax, and you cannot simply embed XML syntax inside of HTML documents. Instead, it has special rules for SVG. Prior to HTML5, it was possible to embed SVG as &#x003C;img&#x003E; elements inside an HTML page or link to self-contained .svg documents. HTML5 introduced inline SVG, in which SVG elements themselves can appear in HTML markup. Of course, in HTML, the syntax rules are more relaxed than in XML. You can have unquoted attributes, mixed capitalization, and so on. You will still need to use self-closing tags when appropriate. For example, you can embed a circle into your HTML document with just a little markup:</p>

<p><pre><code>&#x003C;svg height=100 width=100&#x003E;&#x003C;circle cx=50 cy=50 r=50 /&#x003E;&#x003C;/svg&#x003E;</code></pre></p>

</section>

<section id="sec4_3">
<a id="hdr_sec4_3" class="section-anchor"></a>


<h3>Understanding SVG</h3>

<p>Figure 3-1 shows an HTML5 document with the <em>Happy Trails!</em> image we drew with the canvas API in <a href="ch2.html">Chapter 2</a>. If you read the title of this chapter, you can probably guess that this version was drawn with SVG. SVG lets you do many of the same drawing operations as the canvas API. Much of the time, the results can be visually identical. There are some important invisible differences, however. For one thing, the text is selectable. You don&#x2019;t get that with canvas! When you draw text onto a canvas element, the characters are frozen as pixels. They become part of the image and cannot change unless you redraw a region of the canvas. Because of that, text drawn onto a canvas is invisible to search engines. SVG, on the other hand, is searchable. Google, for instance, indexes the text in SVG content on the web.</p>

<figure class="image">
<img src="images/ch3/fig3-1.png">
<figcaption>Figure 3-1. SVG version of Happy Trails!</figcaption>
</figure>

<p>SVG is closely related to HTML. If you choose, you can define the content of an SVG document with markup. HTML is a declarative language for structuring pages. SVG is a complimentary language for creating visual structures. You can interact with both SVG and HTML using DOM APIs. SVG documents are live trees of elements that you can script and style, just like HTML. You can attach event handlers to SVG elements. For example, you can use click event handlers to make SVG buttons or shaped clickable regions. That is essential for building interactive applications that use mouse input.</p>

<p>Additionally, you can view and edit the structure of the SVG in your browser&#x2019;s development tool. As you can see in Figure 3-2, inline SVG embeds directly into the HTML DOM. It has a structure you can observe and change at runtime. You can dig into SVG and see its source, unlike an image that is just a grid of pixels.</p>

<figure class="image">
<img src="images/ch3/fig3-2.png">
<figcaption>Figure 3-2. Looking at the SVG elements in ChromeWeb Inspector</figcaption>
</figure>

<p>In Figure 3-2, the highlighted text element contains the following code:</p>

<p><pre><code>&#x003C;text y="60" x="200" font-family="impact" font-size="60px" fill="#996600" text-anchor="middle"&#x003E;
Happy Trails
&#x003C;/text&#x003E;</code></pre></p>

<p>In the development environment you can add, remove, and edit SVG elements. The changes take effect instantly in the active page. This is extremely convenient for debugging and experimenting.</p>

<aside>

<h3>Retained-Mode Graphics</h3>

<p><strong>Frank says</strong>: &#x201C;There are two schools of thought in graphics API design. Immediate-mode graphics like canvas provide a drawing interface. API calls cause a drawing action to occur <em>immediately</em>, hence the name. The counter style to immediate mode-graphics is called retained-mode. In retained-mode graphics, there is a model of the visual objects in the scene that is retained over time. There is an API to manipulate the scene graph, and the graphics engine redraws the scene when it changes. SVG is retained-mode graphics in which its scene graph is the document. The API to manipulate SVG is the W3C DOM API.</p>

<p>There are JavaScript libraries that build-retained mode APIs on top of canvas. Some also provide sprites, input handling, and layers. You may choose to use such a library, but remember that these features and more are native in SVG!&#x201D;</p>

</aside>

</section>

<section id="sec5_3">
<a id="hdr_sec5_3" class="section-anchor"></a>


<h3>Scalable Graphics</h3>

<p>When you magnify, rotate, or otherwise transform SVG content, all of the lines making up the image are crisply redrawn. SVG scales without losing quality. The vector information that makes up an SVG document is preserved when it is rendered. Contrast that with pixel graphics. If you magnify a pixel graphic like a canvas or an image, it becomes blurry. That is because the image is composed of pixels that can only be resampled at a higher resolution. The underlying information&#x2014;the paths and shapes that went into making the image&#x2014;is lost after drawing (see Figure 3-3).</p>

<figure class="image">
<img src="images/ch3/fig3-3.png">
<figcaption>Figure 3-3. Closeups of SVG and canvas at 500% magnification</figcaption>
</figure>

</section>

<section id="sec6_3">
<a id="hdr_sec6_3" class="section-anchor"></a>


<h3>Creating 2D Graphics  with SVG</h3>

<p>Let&#x2019;s look again at the <em>Happy Trails!</em> image from Figure 3-1.Every visible part of this SVG drawing has some corresponding markup. The complete SVG language is quite extensive, and all of its details and nuances will not fit in this chapter. However, to get a glimpse of the breadth of the SVG vocabulary, here are some of the features used to draw Happy Trails:</p>

<ul class="bullet">
  <li>Shapes</li>
  <li>Paths</li>
  <li>Transformations</li>
  <li>Patterns and Gradients</li>
  <li>Reusable Content</li>
  <li>Text</li>
</ul>


<p>Let&#x2019;s look at each of these in turn before we combine them into a complete scene. Before we can do that, though, we&#x2019;ll need to see how to add SVG to a page.</p>

</section>

<section id="sec7_3">
<a id="hdr_sec7_3" class="section-anchor"></a>


<h3>Adding SVG to a Page</h3>

<p>Adding inline SVG to an HTML page is as simple as adding any other element.</p>

<p>There are several ways to use SVG on the Web, including as &#x003C;img&#x003E; elements. We will use inline SVG in HTML, because it will integrate into the HTML document. That will let us later write an interactive application that seamlessly combines HTML, JavaScript, and SVG (see Listing 3-1).</p>

<figure class="listing">
<figcaption>Listing 3-1. SVG Containing a Red Rectangle</figcaption>
<pre><code>&#x003C;!doctype html&#x003E;
&#x003C;svg width="200" height="200"&#x003E;
&#x003C;/svg&#x003E;</code></pre>
</figure>

<p>That&#x2019;s it! No XML namespace necessary. Now, between the start and end svg tags, we can add shapes and other visual objects. If you want to split the SVG content out into a separate .svg file, you will need to change it like so:</p>

<pre><code>&#x003C;svg width="400" height="600" xmlns="http://www.w3.org/2000/svg"
    xmlns:xlink="http://www.w3.org/1999/xlink"&#x003E;
&#x003C;/svg&#x003E;</code></pre>

<p>Now it is a valid XML document with the proper namespace attributes. You will be able to open that document with a wide variety of image viewers and editors. You can also refer to an SVG file from HTML as a static image with code such as <code>&#x003C;img src="example.svg"&#x003E;</code>. One downside to that approach is that the SVG document is not integrated into the DOM the way inline SVG content is. You won&#x2019;t be able to script interaction with the SVG elements.</p>

</section>

<section id="sec8_3">
<a id="hdr_sec8_3" class="section-anchor"></a>


<h3>Simple Shapes</h3>

<p>The SVG language includes  basic shape elements such as rectangles, circles, and ellipses. The size and position of shape elements are defined with attributes. For rectangles, these are <code>width</code> and <code>height</code>. For circles, there is an <code>r</code> attribute for radius. All of these use the CSS syntax for distances, so they can be pixels, points, ems, and so on. Listing 3-2 is a very short HTML document containing inline SVG. It is just a gray rectangle with a red outline that is 100 pixels by 80 pixels in size, and it is displayed in Figure 3-4.</p>

<figure class="image">
<img src="images/ch3/fig3-4.png">
<figcaption>Figure 3-4. An SVG rectangle in an HTML document</figcaption>
</figure>



<figure class="listing" data-listing="3-2" data-preview-height="240">
<figcaption>Listing 3-2. SVG Containing a Red Rectangle</figcaption>
<pre><code data-cm-mode="text/html">&#x003C;!doctype html&#x003E;
&#x003C;svg width="200" height="200"&#x003E;
  &#x003C;rect x="10" y="20" width="100" height="80" stroke="red" fill="#ccc" /&#x003E;
&#x003C;/svg&#x003E;</code></pre>
</figure>


<p>SVG draws objects in the order they appear in the document. If we add a circle after the rectangle, it appears on top of the first shape. We will give that circle an 8 pixel wide blue stroke and no fill style (see Listing 3-3), so it stands out, as shown in Figure 3-5.</p>

<figure class="image">
<img src="images/ch3/fig3-5.png">
<figcaption>Figure 3-5. A rectangle and a circle</figcaption>
</figure>


<figure class="listing" data-listing="3-3" data-preview-height="240">
<figcaption>Listing 3-3. A Rectangle and a Circle</figcaption>
<pre><code data-cm-mode="text/html">&#x003C;!doctype html&#x003E;
&#x003C;svg width="200" height="200"&#x003E;
  &#x003C;rect x="10" y="20" width="100" height="80" stroke="red" fill="#ccc" /&#x003E;
  &#x003C;circle cx="120" cy="80" r="40" stroke="#00f" fill="none" stroke-width="8" /&#x003E;
&#x003C;/svg&#x003E;</code></pre>
</figure>




<p>Note that the x and y attributes define  the position of the top-left corner of the rectangle. The circle, on the other hand, has cx and cy attributes, which are the x and y values for the center of the circle. SVG uses the same coordinate system as the canvas API. The top-left corner of the svg element is position 0,0. See <a href="ch2.html">Chapter 2</a> for the details of the canvas coordinate system.</p>

</section>

<section id="sec9_3">
<a id="hdr_sec9_3" class="section-anchor"></a>


<h3>Transforming SVG Elements</h3>

<p>There are organizational elements in SVG intended to combine multiple elements so that they can be transformed or linked to as units. The g element stands for group. Groups can be used to combine multiple related elements. As a group, they can be referred to by a common ID. A group can also be transformed as a unit. If you add a transform attribute to a group, all of that group&#x2019;s contents are transformed. The transform attribute can include commands to rotate (see Listing 3-4 and Figure 3-6), translate, scale, and skew. You can also specify a transformation matrix, just as you can with the canvas API.</p>
  

<figure class="image">
<img src="images/ch3/fig3-6.png">
<figcaption>Figure 3-6. A rotated group</figcaption>
</figure>

<figure class="listing"  data-listing="3-4" data-preview-height="240">
<figcaption>Listing 3-4. A Rectangle and a Circle Within a Rotated Group</figcaption>
<pre><code data-cm-mode="text/html">&#x003C;svg width="200" height="200"&#x003E;
  &#x003C;g transform="translate(60,0) rotate(30) scale(0.75)" id="ShapeGroup"&#x003E;
    &#x003C;rect x="10" y="20" width="100" height="80" stroke="red" fill="#ccc" /&#x003E;
    &#x003C;circle cx="120" cy="80" r="40" stroke="#00f" fill="none" stroke-width="8" /&#x003E;
  &#x003C;/g&#x003E;
&#x003C;/svg&#x003E;</code></pre>

</figure>

</section>

<section id="sec10_3">
<a id="hdr_sec10_3" class="section-anchor"></a>


<h3>Reusing Content</h3>

<p>SVG has a defs element for defining content for future use. It also has an element named &#x201C;use&#x201D; that you can link to your definitions. This lets you reuse the same content multiple times and eliminate redundancy. Figure 3-7 shows a group used three times at different transformed positions and scales. The group has the id &#x201C;ShapeGroup,&#x201D; and it contains a rectangle and a circle. The actual rectangle and circle shapes are just defined the one time inside of the defs element. The defined group is not, by itself, visible. Instead, there are three use elements linked to the shape group, so three rectangles and three circles appear rendered on the page (see Listing 3-5).</p>


<figure class="image">
<img src="images/ch3/fig3-7.png">
<figcaption>Figure 3-7. Three use elements referencing the same group</figcaption>
</figure>



<figure class="listing" data-listing="3-5" data-preview-height="240">
<figcaption>Listing 3-5. Using a Group Three Times</figcaption>
<pre><code data-cm-mode="text/html">&#x003C;svg width="200" height="200"&#x003E;
  &#x003C;defs&#x003E;
    &#x003C;g id="ShapeGroup"&#x003E;
      &#x003C;rect x="10" y="20" width="100" height="80" stroke="red" fill="#ccc" /&#x003E;
      &#x003C;circle cx="120" cy="80" r="40" stroke="#00f" fill="none" stroke-width="8" /&#x003E;
    &#x003C;/g&#x003E;
  &#x003C;/defs&#x003E;
  &#x003C;use xlink:href="#ShapeGroup" transform="translate(60,0) scale(0.5)"/&#x003E;
  &#x003C;use xlink:href="#ShapeGroup" transform="translate(120,80) scale(0.4)"/&#x003E;
  &#x003C;use xlink:href="#ShapeGroup" transform="translate(20,60) scale(0.25)"/&#x003E;
&#x003C;/svg&#x003E;</code></pre>
</figure>


</section>

<section id="sec11_3">
<a id="hdr_sec11_3" class="section-anchor"></a>


<h3>Patterns and Gradients</h3>

<p>The circle and rectangle in Figure 3-7 have simple fill and stroke styles. Objects can be painted with more complex styles, including gradients and patterns (see Listing 3-6). Gradients can be linear or radial. Patterns can be made up of pixel graphics or even other SVG elements. Figure 3-8 shows a rectangle with a linear color gradient as well as a circle with a gravel texture. The texture comes from a JPEG image that is linked to from an SVG image element.</p>

<figure class="image">
<img src="images/ch3/fig3-8.png">
<figcaption>Figure 3-8. A rectangle with a gradient fill and a circle with a pattern fill</figcaption>
</figure>

<figure class="listing" data-listing="3-6" data-preview-height="240">
<figcaption>Listing 3-6. Texturing the Rectangle and Circle</figcaption>
<pre><code data-cm-mode="text/html">&#x003C;!doctype html&#x003E;
&#x003C;svg width="200" height="200"&#x003E;
  &#x003C;defs&#x003E;
    &#x003C;pattern id="GravelPattern" patternUnits="userSpaceOnUse" x="0" y="0" width="100" height="67" viewBox="0 0 100 67"&#x003E;
      &#x003C;image x="0" y="0" width="100" height="67" xlink:href="gravel.jpg"&#x003E;&#x003C;/image&#x003E;
    &#x003C;/pattern&#x003E;
    &#x003C;linearGradient id="RedBlackGradient"&#x003E;
      &#x003C;stop offset="0%" stop-color="#000"&#x003E;&#x003C;/stop&#x003E;
      &#x003C;stop offset="100%" stop-color="#f00"&#x003E;&#x003C;/stop&#x003E;
    &#x003C;/linearGradient&#x003E;
  &#x003C;/defs&#x003E;
  &#x003C;rect x="10" y="20" width="100" height="80" stroke="red" fill="url(#RedBlackGradient)" /&#x003E;
  &#x003C;circle cx="120" cy="80" r="40" stroke="#00f" stroke-width="8" fill="url(#GravelPattern)" /&#x003E;
&#x003C;/svg&#x003E;</code></pre>
</figure>

</section>

<section id="sec12_3">
<a id="hdr_sec12_3" class="section-anchor"></a>


<h3>SVG Paths </h3>

<p>SVG has freeform paths as well as simple shapes. Path elements have d attributes. The d stands for data. Inside the value of the d attribute, you can specify a series of path drawing commands. Each command might take coordinate arguments. Some of the commands are M for moveto, L for lineto, Q for quadratic curve, and Z for closing the path. If these remind you of the canvas drawing API, that is no coincidence. Listing 3-7 uses a path element to draw a closed tree canopy shape using a series of lineto commands.</p>


<figure class="listing">
<figcaption>Listing 3-7. SVG  Path Defining a Tree Canopy</figcaption>
<pre><code>&#x003C;path d="M-25, -50
            L-10, -80
            L-20, -80
            L-5, -110
            L-15, -110
            L0, -140
            L15, -110
            L5, -110
            L20, -80
            L10, -80
            L25, -50
            Z" id="Canopy"&#x003E;&#x003C;/path&#x003E;</code></pre>
</figure>

<p>You can fill a path by closing it with the Z command and giving it a fill attribute, just like the rectangle we drew earlier. Figure 3-9 shows how to draw a tree by combining a stroked closed path and a filled closed path.</p>

<figure class="image">
<img src="images/ch3/fig3-9.png">
<figcaption>Figure 3-9. A stroked path, a filled path, and both paths</figcaption>
</figure>

<p>Similarly, we can create an open path with two quadratic curves to form a trail. We can even give it texture. Note the <code>stroke-linejoin</code> attribute in Listing 3-8. This makes a round connection between the two quadratic curves. Figure 3-10 shows a mountain trail drawn as an open path.</p>

<figure class="image">
<img src="images/ch3/fig3-10.png">
<figcaption>Figure 3-10. An open path containing two quadratic curves</figcaption>
</figure>


<figure class="listing">
<figcaption>Listing 3-8. SVG Path Defining a Twisting Trail</figcaption>
<pre><code>&#x003C;g transform="translate(-10, 350)" stroke-width="20" stroke="url(#GravelPattern)" stroke-linejoin="round"&#x003E;
  &#x003C;path d="M0,0 Q170,-50 260, -190 Q310, -250 410,-250" fill="none"&#x003E;&#x003C;/path&#x003E;
&#x003C;/g&#x003E;</code></pre>
</figure>


</section>

<section id="sec13_3">
<a id="hdr_sec13_3" class="section-anchor"></a>


<h3>Using SVG Text</h3>

<p>SVG also supports text. Text in SVG is selectable within the browser (see Figure 3-11). Should they choose to, browsers and search engines could also allow users to search for text inside of SVG text elements. This has major usability and accessibility benefits.</p>


<figure class="image">
<img src="images/ch3/fig3-11.png">
<figcaption>Figure 3-11. Selecting SVG text</figcaption>
</figure>

<p>SVG Text  has attributes that are similar to CSS style rules for HTML. Listing 3-9 shows a text element that has font-weight and font-family attributes. As in CSS, font-family can be a single font-family name like &#x201C;sans-serif&#x201D; or a list of fallbacks like &#x201C;Droid Sans, sans-serif&#x201D; in the order you prefer.</p>

<figure class="listing" data-listing="3-9" data-preview-height="240">
<figcaption>Listing 3-9. SVG Text</figcaption>
<pre><code data-cm-mode="text/html">&#x003C;svg width="600" height="200"&#x003E;
  &#x003C;text
    x="10" y="80"
    font-family="Droid Sans"
    stroke="#00f"
    fill="#0ff"
    font-size="40px"
    font-weight="bold"&#x003E;
    Select this text!
  &#x003C;/text&#x003E;
&#x003C;/svg&#x003E;</code></pre>
</figure>

</section>

<section id="sec14_3">
<a id="hdr_sec14_3" class="section-anchor"></a>


<h3>Putting the Scene Together</h3>

<p>We can combine all of the preceding elements to make an image of happy trails. The text is, naturally, a text element. The tree trunks are composed of two rectangles. The tree canopies are two paths. The trees cast shadows, which use the same geometry given a gray fill color and a transformation that skews them down and to the right. The winding path that cuts across the image is another path with an image pattern for texture. There is also a little bit of CSS to give the scene an outline.</p>

<p>Listing 3-10 provides the complete code for <code>trails-static.html</code>.</p>

<figure class="listing" data-listing="3-10" data-preview-height="640">
<figcaption>Listing 3-10. Complete Code for <code>trails-static.html</code></figcaption>
<pre><code data-cm-mode="text/html">&#x003C;title&#x003E;Happy Trails in SVG&#x003C;/title&#x003E;
&#x003C;style&#x003E;
  svg {
        border: 1px solid black;
  }
&#x003C;/style&#x003E;
&#x003C;svg width="400" height="600"&#x003E;
  &#x003C;defs&#x003E;
    &#x003C;pattern id="GravelPattern" patternUnits="userSpaceOnUse" x="0" y="0" width="100" height="67" viewBox="0 0 100 67"&#x003E;
      &#x003C;image x=0 y=0 width=100 height=67 xlink:href="gravel.jpg" /&#x003E;
      &#x003C;/pattern&#x003E;
      &#x003C;linearGradient id="TrunkGradient"&#x003E;
      &#x003C;stop offset="0%" stop-color="#663300" /&#x003E;
      &#x003C;stop offset="40%" stop-color="#996600" /&#x003E;
      &#x003C;stop offset="100%" stop-color="#552200" /&#x003E;
      &#x003C;/linearGradient&#x003E;
      &#x003C;rect x="-5" y="-50" width=10 height=50 id="Trunk" /&#x003E;
      &#x003C;path d="M-25, -50
              L-10, -80
              L-20, -80
              L-5, -110
              L-15, -110
              L0, -140
              L15, -110
              L5, -110
              L20, -80
              L10, -80
              L25, -50
              Z"
      id="Canopy"
      /&#x003E;
      &#x003C;linearGradient id="CanopyShadow" x=0 y=0 x2=0 y2=100%&#x003E;
      &#x003C;stop offset="0%" stop-color="#000" stop-opacity=".5" /&#x003E;
      &#x003C;stop offset="20%" stop-color="#000" stop-opacity="0" /&#x003E;
      &#x003C;/linearGradient&#x003E;
      &#x003C;g id="Tree"&#x003E;
      &#x003C;use xlink:href="#Trunk" fill="url(#TrunkGradient)" /&#x003E;
      &#x003C;use xlink:href="#Trunk" fill="url(#CanopyShadow)" /&#x003E;
      &#x003C;use xlink:href="#Canopy" fill="none" stroke="#663300"
      stroke-linejoin="round" stroke-width="4px" /&#x003E;
      &#x003C;use xlink:href="#Canopy" fill="#339900" stroke="none" /&#x003E;
      &#x003C;/g&#x003E;
      &#x003C;g id="TreeShadow"&#x003E;
      &#x003C;use xlink:href="#Trunk" fill="#000" /&#x003E;
      &#x003C;use xlink:href="#Canopy" fill="000" stroke="none" /&#x003E;
      &#x003C;/g&#x003E;
    &#x003C;/defs&#x003E;
  &#x003C;g transform="translate(-10, 350)"
        stroke-width="20"
        stroke="url(#GravelPattern)"
        stroke-linejoin="round"&#x003E;
        &#x003C;path d="M0,0 Q170,-50 260, -190 Q310, -250 410,-250"
        fill="none" /&#x003E;
  &#x003C;/g&#x003E;
  &#x003C;text y=60 x=200
        font-family="impact"
        font-size="60px"
        fill="#996600"
        text-anchor="middle" &#x003E;
        Happy Trails!
  &#x003C;/text&#x003E;
  &#x003C;use xlink:href="#TreeShadow"
        transform="translate(130, 250) scale(1, .6) skewX(-18)"
        opacity="0.4" /&#x003E;
  &#x003C;use xlink:href="#Tree" transform="translate(130,250)" /&#x003E;
  &#x003C;use xlink:href="#TreeShadow"
        transform="translate(260, 500) scale(2, 1.2) skewX(-18)"
        opacity="0.4" /&#x003E;
  &#x003C;use xlink:href="#Tree" transform="translate(260, 500) scale(2)" /&#x003E;
&#x003C;/svg&#x003E;</code></pre>
</figure>

</section>

</section>

<section id="sec15_3">
<a id="hdr_sec15_3" class="section-anchor"></a>

<h2>Building an Interactive Application with SVG</h2>
<p>In this section, we&#x2019;ll expand on the static example. We will add HTML and JavaScript to make the document interactive. We will take advantage of the capabilities of SVG in an application that would require considerably more code to implement with the canvas API.</p>

<section id="sec16_3">
<a id="hdr_sec16_3" class="section-anchor"></a>

<h3>Adding Trees</h3>
<p>We need just a single button element in this interactive application. The click handler for the button adds a new tree at a random location within the 600x400 pixel SVG region. The new tree is also randomly scaled by an amount between 50% and 150%. Each new tree is actually a use element referencing the &#x201C;Tree&#x201D; group containing multiple paths. The code uses the namespaced <code>document.createElementNS()</code> call to create a <code>use</code> element. It links it with the <code>xlink:href</code> attribute to the previously defined Tree group. It then appends the new element to the SVG element tree (see Listing 3-11).</p>

<figure class="listing">
<figcaption>Listing 3-11. Add Tree Function</figcaption>
<pre><code>document.getElementById("AddTreeButton").onclick = function() {
  var x = Math.floor(Math.random() * 400);
  var y = Math.floor(Math.random() * 600);
  var scale = Math.random() + .5;
  var translate = "translate(" + x + "," + y + ") ";
  var tree = document.createElementNS("http://www.w3.org/2000/svg", "use");
  tree.setAttributeNS("http://www.w3.org/1999/xlink", "xlink:href", "#Tree");
  tree.setAttribute("transform", translate + "scale(" + scale + ")");
  document.querySelector("svg").appendChild(tree);
  updateTrees();
}</code></pre>
</figure>


<p>Elements are rendered in the order they appear in the DOM. This function always adds trees as new child nodes at the end of the SVG element&#x2019;s list of child nodes. That means that newer trees will appear on top of older trees.</p>
<p>This function ends with a call to <code>updateTrees()</code>, which we will see next.</p>

</section>
<section id="sec17_3">
<a id="hdr_sec17_3" class="section-anchor"></a>

<h3>Adding the updateTrees Function</h3>
<p>The <code>updateTrees</code> function runs when the document initially loads as well as any time trees are added or removed. It is responsible for updating the text that displays the number of trees in the forest. It also attaches a click handler function to each tree (see Listing 3-12).</p>

<figure class="listing">
<figcaption>Listing 3-12. updateTrees Function</figcaption>
<pre><code>function updateTrees() {
  var list = document.querySelectorAll("use");
  var treeCount = 0;
  for (var i=0; i&#x003C;list.length; i++) {
    if(list[i].getAttribute("xlink:href")=="#Tree") {
      treeCount++;
      list[i].onclick = removeTree;
    }
  }
  var counter = document.getElementById("TreeCounter");
  counter.textContent = treeCount + " trees in the forest";
}</code></pre>
</figure>



<p>An important thing to note about this code is that it keeps no state in JavaScript regarding the tree count. Every time an update occurs, this code selects and filters all of the trees from the live document to get the latest count.</p>

</section>

<section id="sec18_3">
<a id="hdr_sec18_3" class="section-anchor"></a>

<h3>Adding the removeTree Function</h3>
<p>Now, let&#x2019;s add the function that removes trees when they are clicked (see Listing 3-13).</p>


<figure class="listing">
<figcaption>Listing 3-13. removeTree Function</figcaption>
<pre><code>function removeTree(e) {
  var elt = e.target;
  if (elt.correspondingUseElement) {
    elt = elt.correspondingUseElement;
  }
  elt.parentNode.removeChild(elt);
  updateTrees();
}</code></pre>
</figure>


<p>The first thing we do here is check the target of the click event. Due to differences in DOM implementations, the event target could be either the tree group or a use element linked to that group. Either way, this function simply removes that element from the DOM and calls the <code>updateTrees()</code> function.</p>
<p>If you remove a tree that is on top of another tree, you don&#x2019;t have to do anything to redraw the lower content. This is one of the benefits of developing against a retained-mode API. You simply manipulate the tree (no pun intended) of elements, and the browser takes care of drawing the necessary pixels. Similarly, when the text updates to display the latest tree count, it stays below the trees. If you want the text to appear above the trees, you will have to append the trees to the document before the text element.</p>

</section>

<section id="sec19_3">
<a id="hdr_sec19_3" class="section-anchor"></a>

<h3>Adding the CSS Styles</h3>

<p>To make the interaction more discoverable, we will add some CSS that changes the appearance of the tree beneath the mouse cursor:</p>

<p><pre><code>g[id=Tree]:hover {
        opacity: 0.9;
        cursor: crosshair;
  }</code></pre></p>


<p>Whenever you hover over an element with an id attribute equal to &#x201C;Tree,&#x201D; that element will become partially transparent, and the mouse cursor will change to a crosshair.</p>
<p>The one pixel black border around the entire SVG element is also defined in CSS.
</p>
<p><pre><code>svg {
  border: 1px solid black;
}</code></pre></p>



<p>And that&#x2019;s it! Now you have an interactive application using inline SVG in HTML5 (see Figure 3-12).</p>
  
<figure class="image">
<img src="images/ch3/fig3-12.png">
<figcaption>Figure 3-12. The final document with a few trees added</figcaption>
</figure>

</section>

<section id="sec20_3">
<a id="hdr_sec20_3" class="section-anchor"></a>


<h3>The Final Code</h3>

<p>For completeness, Listing 3-14 provides the entire <code>trails-dynamic.html</code> file. It contains all of the SVG from the static version as well as the script that makes it interactive.</p>

<figure class="listing" data-listing="3-14" data-preview-height="660">
<figcaption>Listing 3-14. The Entire <code>trails-dynamic.html</code> Code</figcaption>
<pre><code data-cm-mode="text/html">&#x003C;!doctype html&#x003E;
&#x003C;title&#x003E;Happy Trails in SVG&#x003C;/title&#x003E;
&#x003C;style&#x003E;
  svg {
    border: 1px solid black;
  }
  g[id=Tree]:hover {
    opacity: 0.9;
    cursor: crosshair;
  }
&#x003C;/style&#x003E;
&#x003C;div&#x003E;
  &#x003C;button id="AddTreeButton"&#x003E;Add Tree&#x003C;/button&#x003E;
&#x003C;/div&#x003E;
&#x003C;svg width="400" height="600"&#x003E;
  &#x003C;defs&#x003E;
    &#x003C;pattern id="GravelPattern" patternUnits="userSpaceOnUse" x="0" y="0" width="100" height="67" viewBox="0 0 100 67"&#x003E;</Para>
      &#x003C;image x=0 y=0 width=100 height=67 xlink:href="gravel.jpg" /&#x003E;
    &#x003C;/pattern&#x003E;
    &#x003C;linearGradient id="TrunkGradient"&#x003E;
        &#x003C;stop offset="0%" stop-color="#663300" /&#x003E;
        &#x003C;stop offset="40%" stop-color="#996600" /&#x003E;
        &#x003C;stop offset="100%" stop-color="#552200" /&#x003E;
    &#x003C;/linearGradient&#x003E;
    &#x003C;rect x="-5" y="-50" width=10 height=50 id="Trunk" /&#x003E;
    &#x003C;path d="M-25, -50
            L-10, -80
            L-20, -80
            L-5, -110
            L-15, -110
            L0, -140
            L15, -110
            L5, -110
            L20, -80
            L10, -80
            L25, -50
            Z"
        id="Canopy"/&#x003E;
    &#x003C;linearGradient id="CanopyShadow" x=0 y=0 x2=0 y2=100%&#x003E;
      &#x003C;stop offset="0%" stop-color="#000" stop-opacity=".5" /&#x003E;
      &#x003C;stop offset="20%" stop-color="#000" stop-opacity="0" /&#x003E;
    &#x003C;/linearGradient&#x003E;
    &#x003C;g id="Tree"&#x003E;
      &#x003C;use xlink:href="#Trunk" fill="url(#TrunkGradient)" /&#x003E;
      &#x003C;use xlink:href="#Trunk" fill="url(#CanopyShadow)" /&#x003E;
      &#x003C;use xlink:href="#Canopy" fill="none" stroke="#663300"
         stroke-linejoin="round" stroke-width="4px" /&#x003E;
      &#x003C;use xlink:href="#Canopy" fill="#339900" stroke="none" /&#x003E;
    &#x003C;/g&#x003E;
  &#x003C;/defs&#x003E;
  &#x003C;g transform="translate(-10, 350)"
      stroke-width="20"
      stroke="url(#GravelPattern)"
      stroke-linejoin="round"&#x003E;
        &#x003C;path d="M0,0 Q170,-50 260, -190 Q310, -250 410,-250"
          fill="none" /&#x003E;
  &#x003C;/g&#x003E;
  &#x003C;text y=60 x=200
    font-family="impact"
    font-size="60px"
    fill="#996600"
    text-anchor="middle" &#x003E;
    Happy Trails!
  &#x003C;/text&#x003E;
  &#x003C;text y=90 x=200
    font-family="impact"
    font-size="20px"
    fill="#996600"
    text-anchor="middle" id="TreeCounter"&#x003E;
  &#x003C;/text&#x003E;
  &#x003C;text y=420 x=20
    font-family="impact"
    font-size="20px"
    fill="#996600"
    text-anchor="left"&#x003E;
    &#x003C;tspan&#x003E;You can remove a&#x003C;/tspan&#x003E;
  &#x003C;tspan y=440 x=20&#x003E;tree by clicking on it.&#x003C;/tspan&#x003E;
  &#x003C;/text&#x003E;
  &#x003C;use xlink:href="#Tree" transform="translate(130,250)" /&#x003E;
  &#x003C;use xlink:href="#Tree" transform="translate(260, 500) scale(2)" /&#x003E;
&#x003C;/svg&#x003E;
&#x003C;script&#x003E;
  function removeTree(e) {
    var elt = e.target;
    if (elt.correspondingUseElement) {
      elt = elt.correspondingUseElement;
    }
    elt.parentNode.removeChild(elt);
    updateTrees();
  }
  document.getElementById("AddTreeButton").onclick = function() {
    var x = Math.floor(Math.random() * 400);
    var y = Math.floor(Math.random() * 600);
    var scale = Math.random() + .5;
    var translate = "translate(" + x + "," + y + ") ";
    var tree = document.createElementNS("http://www.w3.org/2000/svg", "use");
    tree.setAttributeNS("http://www.w3.org/1999/xlink", "xlink:href", "#Tree");
    tree.setAttribute("transform", translate + "scale(" + scale + ")");
    document.querySelector("svg").appendChild(tree);
    updateTrees();
  }
  function updateTrees() {
    var list = document.querySelectorAll("use");
    var treeCount = 0;
    for (var i=0; i&#x003C;list.length; i++) {
      if(list[i].getAttribute("xlink:href")=="#Tree") {
        treeCount++;
        list[i].onclick = removeTree;
      }
    }
    var counter = document.getElementById("TreeCounter");
    counter.textContent = treeCount + " trees in the forest";
  }
  updateTrees();
&#x003C;/script&#x003E;</code></pre>
</figure>


<aside>

<h3>SVG TOOLS</h3>

<p><strong>Frank says</strong>:</p>

<p>&#x201C;Because of SVG&#x2019;s long history as a standard format for vector graphics, there are many useful tools for working with SVG images. There is even an open-source editor called SVG-edit that runs in the browser. You can embed it in your own applications! On the desktop, Adobe Illustrator and Inkscape are two powerful vector graphics applications that can both import and export SVG. I&#x2019;ve found Inkscape to be very useful for creating new graphics (see Figure 3-13).</p>

<p>SVG tools tend to work with standalone .svg files, not SVG embedded in HTML, so you may need to convert between the two formats.&#x201D;</p>

</aside>

<figure class="image">
<img src="images/ch3/fig3-13.png">
<figcaption>Figure 3-13. Modifying the stroke of a text element in Inkscape</figcaption>
</figure>

</section>
<section id="sec21_3">
<a id="hdr_sec21_3" class="section-anchor"></a>

<h3>Summary</h3>
<p>In this chapter, you have seen how SVG in HTML5 provides a powerful way to create applications with interactive two dimensional graphics.</p>
<p>First we looked at a scene drawn using SVG embedded in an HTML5 document. We examined the elements and attributes that made up the drawing. We saw how you can define and reuse content definitions, group and transform elements, and draw with shapes, paths, and text.</p>
<p>Finally, we added JavaScript to an SVG document to make an interactive application. We used CSS, DOM manipulation, and events to take advantage of SVG&#x2019;s nature as a live document.</p>
<p>Now that we&#x2019;ve seen how SVG brings vector graphics to HTML5, we&#x2019;ll turn our attention to the communication features that can connect your web app to the outside world.</p>
</section>

</section>

<footer class="next-chapter">
  <p><a href="ch4.html">Go to the Next Chapter</a></p>
</footer>

</div>
</article>

<!--====================== END CONTENT ======================-->

<a id="main-navigation"></a>  
<div class="nav-container">    
<nav id="menu" role="navigation">
<ul>
  <li class="current"><a href="#chapter_title">Chapter 3</a>
    <ul>
      <li><a href="#hdr_sec2_3">Overview of SVG</a>
        <ul>
          <li><a href="#hdr_sec3_3">History</a></li>
          <li><a href="#hdr_sec4_3">Understanding SVG</a></li>
          <li><a href="#hdr_sec5_3">Scalable Graphics</a></li>
          <li><a href="#hdr_sec6_3">Creating 2D Graphics  with SVG</a></li>
          <li><a href="#hdr_sec7_3">Adding SVG to a Page</a></li>
          <li><a href="#hdr_sec8_3">Simple Shapes</a></li>
          <li><a href="#hdr_sec9_3">Transforming SVG Elements</a></li>
          <li><a href="#hdr_sec10_3">Reusing Content</a></li>
          <li><a href="#hdr_sec11_3">Patterns and Gradients</a></li>
          <li><a href="#hdr_sec12_3">SVG Paths </a></li>
          <li><a href="#hdr_sec13_3">Using SVG Text</a></li>
          <li><a href="#hdr_sec14_3">Putting the Scene Together</a></li>
        </ul>
      </li>
      <li><a href="#hdr_sec15_3">Building an Interactive Application with SVG</a>
        <ul>
          <li><a href="#hdr_sec16_3">Adding Trees</a></li>
          <li><a href="#hdr_sec17_3">Adding the updateTrees Function</a></li>
          <li><a href="#hdr_sec18_3">Adding the removeTree Function</a></li>
          <li><a href="#hdr_sec19_3">Adding the CSS Styles</a></li>
          <li><a href="#hdr_sec20_3">The Final Code</a></li>
          <li><a href="#hdr_sec21_3">Summary</a></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
</nav>
</div>

  </body>

</html>
